Description: backport hsize validation for empty PCOMP
 Backport hsize validation from libzpaq v7.15
 This prevents Denial of Service via a crafted file due to a heap overflow
 via the ibzpaq::PostProcessor::write(int) function.
Author: Laszlo Boszormenyi (GCS) <gcs@debian.org>
Origin: backport, https://mattmahoney.net/dc/zpaq.html
Bug: https://github.com/ckolivas/lrzip/issues/246
Bug-Debian: https://bugs.debian.org/1059293
Forwarded: no
Last-Update: 2023-12-22

---

--- a/libzpaq/libzpaq.cpp
+++ b/libzpaq/libzpaq.cpp
@@ -1195,6 +1195,7 @@ int PostProcessor::write(int c) {
     case 3:  // PROG psize[0]
       if (c<0) error("Unexpected EOS");
       hsize+=c*256;  // high byte of psize
+      if (hsize<1) error("Empty PCOMP");
       z.header.resize(hsize+300);
       z.cend=8;
       z.hbegin=z.hend=z.cend+128;
